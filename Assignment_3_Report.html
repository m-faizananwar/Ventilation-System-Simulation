<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignment 3: System Architecture and Implementation Blueprint</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;600&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            color: #1a1a1a;
            background: #ffffff;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20mm;
        }

        /* Print Styles */
        @media print {
            body {
                padding: 15mm;
                max-width: 100%;
            }

            .page-break {
                page-break-before: always;
            }

            h1,
            h2 {
                page-break-after: avoid;
            }

            pre,
            code {
                page-break-inside: avoid;
            }
        }

        /* Title Page */
        .title-page {
            text-align: center;
            padding: 60px 0;
            border-bottom: 3px solid #2563eb;
            margin-bottom: 40px;
        }

        .title-page h1 {
            font-size: 28px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .title-page .project-title {
            font-size: 22px;
            font-weight: 600;
            color: #2563eb;
            margin: 20px 0;
        }

        .course-info {
            font-size: 14px;
            color: #475569;
            margin: 20px 0;
        }

        .team-table {
            width: 100%;
            max-width: 600px;
            margin: 30px auto;
            border-collapse: collapse;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .team-table th {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .team-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .team-table tr:hover {
            background-color: #f8fafc;
        }

        /* Headers */
        h2 {
            font-size: 22px;
            font-weight: 700;
            color: #1e293b;
            margin: 40px 0 20px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }

        h3 {
            font-size: 18px;
            font-weight: 600;
            color: #334155;
            margin: 30px 0 15px 0;
        }

        /* Paragraphs */
        p {
            margin-bottom: 16px;
            text-align: justify;
        }

        /* Lists */
        ul {
            margin: 16px 0 16px 24px;
        }

        li {
            margin-bottom: 8px;
        }

        /* Code Blocks */
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
            color: #dc2626;
        }

        pre code {
            background: transparent;
            padding: 0;
            color: #e2e8f0;
        }

        /* Syntax Highlighting */
        .keyword {
            color: #60a5fa;
        }

        .comment {
            color: #94a3b8;
            font-style: italic;
        }

        .string {
            color: #86efac;
        }

        .number {
            color: #fbbf24;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        table th {
            background: #f8fafc;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #cbd5e1;
        }

        table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        /* Mermaid Diagrams */
        .mermaid {
            background: #f8fafc;
            padding: 30px;
            border-radius: 8px;
            margin: 30px 0;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        /* Emphasis Boxes */
        .info-box {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-left: 4px solid #2563eb;
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .info-box strong {
            color: #1e40af;
        }

        /* Section Numbers */
        .section-number {
            display: inline-block;
            background: #2563eb;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            margin-right: 12px;
            font-weight: 700;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
            color: #64748b;
            font-size: 14px;
        }
    </style>
</head>

<body>
    <!-- Title Page -->
    <div class="title-page">
        <h1>Assignment 3: System Architecture and Implementation Blueprint<br>of RISC-V based Embedded System Project
        </h1>

        <div class="project-title">Smart Corridor Ventilation & Air Quality Monitoring System</div>

        <div class="course-info">
            <strong>Course:</strong> CS-221 Computer Organization and Assembly Language<br>
            <strong>Class/Section:</strong> BSCS-3B<br>
            <strong>Group Number:</strong> 05
        </div>

        <table class="team-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>CMS-ID</th>
                    <th>Role</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Faizan Anwar</strong> (Team Rep)</td>
                    <td><strong>455259</strong></td>
                    <td>System Architect & Lead Developer</td>
                </tr>
                <tr>
                    <td>Abdul Moiz</td>
                    <td>465932</td>
                    <td>Hardware Simulation Specialist</td>
                </tr>
                <tr>
                    <td>Muhammad Taha</td>
                    <td>467244</td>
                    <td>Software Engineer (Assembly)</td>
                </tr>
                <tr>
                    <td>Sham</td>
                    <td>457919</td>
                    <td>Testing & Validation Engineer</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Section 1 -->
    <h2><span class="section-number">1</span>Introductory Overview of the Project</h2>

    <p>The <strong>Smart Corridor Ventilation & Air Quality Monitoring System</strong> is an embedded safety solution
        designed to address the critical issue of indoor air quality (IAQ) and fire safety in enclosed architectures. In
        modern smart buildings, delays in hazard detection can lead to severe health outcomes.</p>

    <div class="info-box">
        <strong>Problem Statement:</strong> Conventional ventilation systems are often manual or timer-based, failing to
        respond dynamically to real-time hazards such as elevated CO2 levels (hypercapnia risk), PM2.5 particulate
        accumulation, or smoke infiltration.
    </div>

    <p><strong>High-Level Implementation Plan:</strong> Our system acts as an autonomous "reflex" mechanism for the
        building. It utilizes a <strong>RISC-V processor</strong> as the central control unit to ensure deterministic
        low-latency processing.</p>

    <ul>
        <li><strong>Major Components:</strong> RISC-V Core, Memory-Mapped Sensor Interface (Smoke, PM2.5, CO2), Actuator
            Control Interface (Fans), and Visual Status Indicators.</li>
        <li><strong>Expected Outcomes:</strong> A fail-safe system capable of detecting hazards within milliseconds and
            activating mitigative ventilation without human intervention.</li>
        <li><strong>Key Assumptions:</strong> The system operates in a continuous polling loop (Infinite Execution),
            assuming a stable power supply and that sensors provide linear analog-to-digital mappings.</li>
    </ul>

    <!-- Section 2 -->
    <div class="page-break"></div>
    <h2><span class="section-number">2</span>Process-Flow Representation</h2>

    <p>The following diagram represents the deterministic operational sequence. The logic prioritizes immediate
        life-safety threats (Smoke) over long-term health hazards (CO2).</p>

    <div class="mermaid">
        graph TD
        A([Start / Reset]) --> B[Data Acquisition Phase <br /> Load Sensor Data from Memory Address 0xF0000000]
        B --> C{Critical Check 1: <br /> Smoke Detected? <br /> Bit 0 equals 1}

        C -- YES Hazard --> H[CRITICAL SAFETY MODE]
        C -- NO --> D{Critical Check 2: <br /> PM2.5 exceeds Threshold? <br /> Bits 1-7 greater than 100}

        D -- YES Hazard --> H
        D -- NO --> E{Critical Check 3: <br /> CO2 exceeds Threshold? <br /> Bank 1 greater than 100}

        E -- YES Hazard --> H
        E -- NO --> F[SAFE MODE <br /> Normal Operation]

        subgraph "Actuation & Feedback"
        F --> G[Action: Deactivate Fan <br /> Feedback: Draw GREEN LED Pattern]
        H --> I[Action: Activate Fan <br /> Feedback: Draw RED LED Alarm]
        end

        G --> B
        I --> B
    </div>

    <div class="info-box">
        <strong>Evaluation of Logical Dependencies:</strong> The flow creates a "short-circuit" hierarchy. The check for
        Smoke is placed first to minimize instruction cycles before a critical alarm determination. This ensures that in
        a fire scenario, the system validates the threat in the fewest possible clock cycles, meeting the rigorous
        timing constraints of safety systems.
    </div>

    <!-- Section 3 -->
    <h2><span class="section-number">3</span>RISC-V–Centred Architectural Layout</h2>

    <p>The system follows a modified Harvard Architecture approach (simulated) with Memory Mapped I/O, positioning the
        RISC-V core as the bridge between the physical world and digital logic.</p>

    <div class="mermaid">
        graph TB
        subgraph "Peripheral Layer - Sensors and Actuators"
        S1[Smoke Detector <br /> Digital Switch]
        S2[PM2.5 Sensor <br /> 7-bit Analog]
        S3[CO2 Sensor <br /> 8-bit Analog]
        FAN[Ventilation Fan <br /> Motor]
        LED[LED Matrix <br /> Visual Interface]
        end

        subgraph "RISC-V Microcontroller System"
        direction TB
        BUS[[System Bus <br /> Data/Addr/Ctrl]]

        CPU[RISC-V CPU Core <br /> Registers: x0-x31 <br /> ALU: Masking/Branching]

        subgraph "Memory Map Interface"
        MM1[0xF0000000 <br /> Input Bank 0 <br /> Smoke and PM2.5]
        MM2[0xF0000004 <br /> Input Bank 1 <br /> CO2 Level]
        MM3[0xF0000008 <br /> Output Control <br /> LEDs and Fan Signal]
        end
        end

        S1 -->|Bit 0| MM1
        S2 -->|Bits 1-7| MM1
        S3 -->|Bits 0-7| MM2

        MM1 <==> BUS
            MM2 <==> BUS
                MM3 <==> BUS
                    BUS <==> CPU

                        MM3 -->|Mapped Write| LED
                        MM3 -->|Mapped Write| FAN
    </div>

    <p><strong>Component Justification:</strong></p>
    <ul>
        <li><strong>RISC-V Core:</strong> Selected for its reduced instruction set, allowing for efficient, predictable
            code execution crucial for real-time monitoring.</li>
        <li><strong>Memory Interfaces (MM1-MM3):</strong> These decouple the processor from hardware implementation
            details. The CPU simply executes <code>LW</code> (Load Word) and <code>SW</code> (Store Word) instructions,
            treating hardware states as memory addresses.</li>
        <li><strong>System Bus:</strong> The backbone facilitating high-speed data transfer between the Core and the
            MMIO registers.</li>
    </ul>

    <!-- Section 4 -->
    <div class="page-break"></div>
    <h2><span class="section-number">4</span>System Requirements Analysis</h2>

    <h3>Functional Requirements:</h3>
    <ol>
        <li><strong>Immediate Interrupt/Polling:</strong> System must Poll sensors at least every 200ms to detect
            changes.</li>
        <li><strong>Multi-Hazard Logic:</strong> System must be able to handle simultaneous hazards (e.g., Smoke + High
            CO2) without deadlock.</li>
        <li><strong>Visual Latency:</strong> LED Matrix update latency must be < 100ms to provide immediate visual
                feedback to occupants.</li>
    </ol>

    <h3>Constraints & System Boundaries:</h3>
    <ul>
        <li><strong>Power Usage:</strong> As an always-on embedded system, the instruction loop must be efficient to
            minimize dynamic power consumption (switching activity).</li>
        <li><strong>Accuracy Thresholds:</strong>
            <ul>
                <li>PM2.5 Threshold: > 100 μg/m³</li>
                <li>CO2 Threshold: > 1000 ppm (Scaled to 100 in simulation register)</li>
            </ul>
        </li>
        <li><strong>Cost Limitations:</strong> The design minimizes complex floating-point units (FPU) by using integer
            arithmetic and bitwise logic, allowing it to run on low-cost RISC-V integer (RV32I) cores.</li>
    </ul>

    <!-- Section 5 -->
    <h2><span class="section-number">5</span>Hardware–Software Partitioning</h2>

    <p>This design uses a <strong>Software-Driven Control</strong> approach on <strong>General Purpose
            Hardware</strong>.</p>

    <table>
        <thead>
            <tr>
                <th>Component/Function</th>
                <th>Partition</th>
                <th>Implementation Detail</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Logic Core</strong></td>
                <td><strong>Software</strong></td>
                <td>The decision-making (If Smoke → then Alarm) is flexible code running on the RISC-V Core, allowing
                    for easy updates to thresholds.</td>
            </tr>
            <tr>
                <td><strong>Bitwise Masking</strong></td>
                <td><strong>Software</strong></td>
                <td>Instructions like <code>AND</code>, <code>SRLI</code> are used to "slice" the raw data word into
                    meaningful sensor values.</td>
            </tr>
            <tr>
                <td><strong>Sensor Interface</strong></td>
                <td><strong>Hardware</strong></td>
                <td>Physical A/D conversion is abstracted as hardware registers.</td>
            </tr>
            <tr>
                <td><strong>Actuator Drive</strong></td>
                <td><strong>Hardware</strong></td>
                <td>High-current switching for the Fan is handled by hardware logic triggered by the software writing to
                    the specific memory address.</td>
            </tr>
        </tbody>
    </table>

    <!-- Section 6 -->
    <div class="page-break"></div>
    <h2><span class="section-number">6</span>Computational Algorithm Implementation Plan</h2>

    <p><strong>Implementation Strategy:</strong> We have opted for a <strong>Direct Assembly Implementation</strong>
        (Native RISC-V) rather than compiling from High-Level Language (C/C++).</p>

    <ul>
        <li><strong>Reasoning:</strong> Direct assembly allows for precise control over register allocation and
            instruction scheduling. In a safety-critical loop, avoiding the overhead of a compiler's prologue/epilogue
            sequences ensures minimum latency.</li>
        <li><strong>Logic:</strong> The algorithm relies heavily on <strong>Bitwise Operations</strong>
            (<code>AND</code>, <code>SRLI</code>) to parse the packed data from the memory-mapped registers.</li>
    </ul>

    <h3>Core Code Snippets:</h3>

    <p><strong>1. Sensor Polling & Smoke Check (Critical Path)</strong></p>
    <pre><code><span class="comment"># Main loop - continuously monitor sensors</span>
<span class="keyword">main_loop:</span>
    <span class="keyword">li</span> t0, SW0_BASE         <span class="comment"># Load Base Address 0xF0000000</span>
    <span class="keyword">lw</span> s0, <span class="number">0</span>(t0)            <span class="comment"># Read Raw Input (Smoke + PM2.5)</span>
    
    <span class="keyword">li</span> t1, <span class="number">1</span>                <span class="comment"># Mask for Bit 0</span>
    <span class="keyword">and</span> a0, s0, t1          <span class="comment"># Isolate Smoke Bit</span>
    <span class="keyword">bnez</span> a0, unsafe_mode    <span class="comment"># Branch IMMEDIATELY if Smoke detected</span></code></pre>

    <p><strong>2. PM2.5 Parsing (Data Extraction)</strong></p>
    <pre><code>    <span class="keyword">srli</span> a1, s0, <span class="number">1</span>          <span class="comment"># Logical Shift Right by 1 to remove Smoke bit</span>
    <span class="keyword">li</span> t1, <span class="number">0x7F</span>             <span class="comment"># Mask 0x7F (01111111) to isolate 7-bit value</span>
    <span class="keyword">and</span> a1, a1, t1          <span class="comment"># a1 now holds clean PM2.5 value</span>
    
    <span class="keyword">li</span> t2, THRESH_PM25      <span class="comment"># Load Safety Constant (100)</span>
    <span class="keyword">bgt</span> a1, t2, unsafe_mode <span class="comment"># Compare and Branch</span></code></pre>

    <!-- Section 7 -->
    <h2><span class="section-number">7</span>Hardware or Simulator Utilization Plan</h2>

    <p><strong>Selected Approach: Simulation-Based Demonstration</strong></p>

    <h3>Feasibility Analysis:</h3>
    <ul>
        <li><strong>Physical Hardware:</strong> Prototyping with FPGA (for soft-core RISC-V) or discrete chips is
            cost-prohibitive and time-intensive for this semester's scope.</li>
        <li><strong>Simulation (Ripes):</strong> Offers bit-accurate visualization of the processor pipeline
            (<code>IF</code>, <code>ID</code>, <code>EX</code>, <code>MEM</code>, <code>WB</code>). This is superior for
            demonstrating <em>Architecture</em> concepts as it allows us to inspect the register file and memory map in
            real-time.</li>
    </ul>

    <div class="info-box">
        <strong>Decision:</strong> The final demonstration will be conducted using <strong>Ripes</strong> to showcase
        the assembly logic and memory interaction, supplemented by <strong>Wokvi</strong> (ESP32) to demonstrate the
        high-level IoT connectivity concept. This dual approach maximizes the technical breadth of the project.
    </div>

    <!-- Section 8 -->
    <h2><span class="section-number">8</span>Preliminary Testing and Validation Strategy</h2>

    <p>To ensure zero-defect reliability, we employ a bottom-up testing strategy.</p>

    <h3>Testing Methodology:</h3>
    <ol>
        <li><strong>Unit Testing (Module Level):</strong>
            <ul>
                <li><em>Masking Logic:</em> Verify <code>AND</code> operations correctly isolate bits 0, 1-7, and 0-7.
                </li>
                <li><em>Branch Logic:</em> Manually inject values 99 (Safe) and 101 (Danger) into registers to verify
                    conditional jumps.</li>
            </ul>
        </li>
        <li><strong>Integration Testing (System Level):</strong>
            <ul>
                <li>Run the main loop. Toggle "Smoke" switch. <strong>Metric:</strong> LED Matrix must turn Red within 1
                    cycle.</li>
                <li>Simulate "Noisy Data" (random bits in unused regions). <strong>Metric:</strong> System should ignore
                    bits outside the defined masks.</li>
            </ul>
        </li>
    </ol>

    <h3>Testing Tools:</h3>
    <ul>
        <li><strong>Ripes Simulator:</strong> For architectural validation and step-by-step debugging.</li>
        <li><strong>Wokvi:</strong> For verifying the logic flow with high-level C++ code before translating to
            Assembly.</li>
    </ul>

    <div class="footer">
        <p><em>Submitted by Group 05 for CS-221 Computer Organization and Assembly Language</em></p>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#dbeafe',
                primaryTextColor: '#1e293b',
                primaryBorderColor: '#2563eb',
                lineColor: '#475569',
                secondaryColor: '#f1f5f9',
                tertiaryColor: '#f8fafc'
            }
        });
    </script>
</body>

</html>